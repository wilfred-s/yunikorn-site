<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.63">
<title data-react-helmet="true">Run Spark Jobs | Apache YuniKorn (Incubating)</title><meta data-react-helmet="true" name="docsearch:version" content="0.10.0,latest"><meta data-react-helmet="true" property="og:image" content="http://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-react-helmet="true" property="twitter:image" content="http://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Apache YuniKorn (Incubating)"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Run Spark Jobs | Apache YuniKorn (Incubating)"><meta data-react-helmet="true" name="description" content="How to run Spark jobs with YuniKorn"><meta data-react-helmet="true" property="og:description" content="How to run Spark jobs with YuniKorn"><meta data-react-helmet="true" name="keywords" content="spark"><meta data-react-helmet="true" property="og:url" content="http://yunikorn.apache.org/docs/user_guide/workloads/run_spark"><link data-react-helmet="true" rel="shortcut icon" href="/img/yunikorn.ico"><link data-react-helmet="true" rel="canonical" href="http://yunikorn.apache.org/docs/user_guide/workloads/run_spark"><link rel="stylesheet" href="/styles.3300edef.css">
<link rel="preload" href="/styles.42927ee7.js" as="script">
<link rel="preload" href="/runtime~main.1daa9f04.js" as="script">
<link rel="preload" href="/main.6222ead5.js" as="script">
<link rel="preload" href="/1.f2f38753.js" as="script">
<link rel="preload" href="/2.05510059.js" as="script">
<link rel="preload" href="/3.a37a1908.js" as="script">
<link rel="preload" href="/1be78505.e1f44db4.js" as="script">
<link rel="preload" href="/146.37105179.js" as="script">
<link rel="preload" href="/9ce8caa5.a08d3d56.js" as="script">
<link rel="preload" href="/17896441.6af894f7.js" as="script">
<link rel="preload" href="/761be9ac.f481fd70.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/yunikorn.ico" alt="YuniKorn Site Logo"><strong class="navbar__title">Apache YuniKorn</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Quick Start</a><a class="navbar__item navbar__link" href="/community/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/community/download">Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/community/get_involved">Get Involved</a></li><li><a class="dropdown__link" position="left" href="/community/how_to_contribute">How to Contribute</a></li><li><a class="dropdown__link" position="left" href="/community/coding_guidelines">Coding Guidelines</a></li><li><a class="dropdown__link" position="left" href="/community/reporting_issues">Reporting Issues</a></li><li><a class="dropdown__link" position="left" href="/community/sessions">Sessions and Demos</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Apache</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Apache Software Foundation</a></li><li><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Apache Incubator</a></li><li><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Apache License</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Sponsorship</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/docs/next/">Master</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" position="left" href="/docs/">0.10.0</a></li><li><a class="dropdown__link" position="left" href="/docs/0.9.0/">0.9.0</a></li><li><a class="dropdown__link" position="left" href="/docs/0.8.0/">0.8.0</a></li></ul></div><a href="https://github.com/apache/incubator-yunikorn-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/yunikorn.ico" alt="YuniKorn Site Logo"><strong class="navbar__title">Apache YuniKorn</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Quick Start</a></li><li class="menu__list-item"><a class="menu__link" href="/community/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/community/download">Download</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/community/get_involved">Get Involved</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/how_to_contribute">How to Contribute</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/coding_guidelines">Coding Guidelines</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/reporting_issues">Reporting Issues</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/sessions">Sessions and Demos</a></li></ul></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">Apache</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Apache Software Foundation</a></li><li class="menu__list-item"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Apache Incubator</a></li><li class="menu__list-item"><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Apache License</a></li><li class="menu__list-item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Sponsorship</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--sublist navbar__link--active" href="/docs">Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/next/">Master</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" position="left" href="/docs/">0.10.0</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/0.9.0/">0.9.0</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/0.8.0/">0.8.0</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/apache/incubator-yunikorn-core" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Get Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/release-announce/0.10.0/">Release Notes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Get Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/get_started/core_features">Features</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">User Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_guide/queue_config">Partition and Queue Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_guide/placement_rules">App Placement Rules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_guide/sorting_policies">Sorting Policies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_guide/acls">ACLs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_guide/resource_quota_management">Resource Quota Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_guide/gang_scheduling">Gang Scheduling</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Workloads</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/user_guide/workloads/run_spark">Run Spark Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_guide/workloads/run_flink">Run Flink Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_guide/workloads/run_tf">Run Tensorflow Jobs</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">REST APIs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/cluster">Cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/scheduler">Scheduler</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/system">System</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/user_guide/trouble_shooting">Trouble Shooting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Developer Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/developer_guide/env_setup">Dev Environment Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/developer_guide/build">Build and Run</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/developer_guide/deployment">Deploy to Kubernetes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/developer_guide/openshift_development">Development in CodeReady Containers</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Designs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/design/architecture">Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/design/scheduler_core_design">Scheduler Core Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/design/cache_removal">Scheduler cache removal design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/design/k8shim">Kubernetes Shim Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/design/cross_queue_preemption">Cross Queue Preemption</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/design/namespace_resource_quota">Namespace Resource Quota</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/design/pluggable_app_management">Pluggable App Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/design/resilience">Resilience</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/design/predicates">Support K8s Predicates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/design/scheduler_configuration">Scheduler Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/design/state_aware_scheduling">Batch Workloads Ordering with StateAware Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/design/scheduler_object_states">Scheduler Object States</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Performance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/performance/evaluate_perf_function_with_kubemark">Evaluate YuniKorn function &amp; performance with Kubemark</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/performance/metrics">Scheduler Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/performance/profiling">Profiling</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: 0.10.0</span></div><header><h1 class="docTitle_1Lrw">Run Spark Jobs</h1></header><div class="markdown"><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>This document assumes you have YuniKorn and its admission-controller both installed. Please refer to
<a href="/docs/">get started</a> to see how that is done.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="prepare-the-docker-image-for-spark"></a>Prepare the docker image for Spark<a aria-hidden="true" tabindex="-1" class="hash-link" href="#prepare-the-docker-image-for-spark" title="Direct link to heading">#</a></h2><p>To run Spark on Kubernetes, you&#x27;ll need the Spark docker images. You can 1) use the docker images provided by the YuniKorn
team, or 2) build one from scratch. If you want to build your own Spark docker image, you can</p><ul><li>Download a Spark version that has Kubernetes support, URL: <a href="https://github.com/apache/spark" target="_blank" rel="noopener noreferrer">https://github.com/apache/spark</a></li><li>Build spark with Kubernetes support:</li></ul><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">mvn -Pyarn -Phadoop-2.7 -Dhadoop.version</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">2.7</span><span class="token plain">.4 -Phive -Pkubernetes -Phive-thriftserver -DskipTests package</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="create-a-namespace-for-spark-jobs"></a>Create a namespace for Spark jobs<a aria-hidden="true" tabindex="-1" class="hash-link" href="#create-a-namespace-for-spark-jobs" title="Direct link to heading">#</a></h2><p>Create a namespace:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">cat</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token string" style="color:rgb(195, 232, 141)">EOF</span><span class="token string bash punctuation" style="color:rgb(199, 146, 234)"> </span><span class="token string bash punctuation operator" style="color:rgb(137, 221, 255)">|</span><span class="token string bash punctuation" style="color:rgb(199, 146, 234)"> kubectl apply -f -</span><span class="token string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">apiVersion: v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">kind: Namespace</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  name: spark-test</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">EOF</span></div></div></div></div></div><p>Create service account and cluster role bindings under <code>spark-test</code> namespace:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">cat</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token string" style="color:rgb(195, 232, 141)">EOF</span><span class="token string bash punctuation" style="color:rgb(199, 146, 234)"> </span><span class="token string bash punctuation operator" style="color:rgb(137, 221, 255)">|</span><span class="token string bash punctuation" style="color:rgb(199, 146, 234)"> kubectl apply -n spark-test -f -</span><span class="token string" style="color:rgb(195, 232, 141)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">apiVersion: v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">kind: ServiceAccount</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  name: spark</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">---</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">apiVersion: rbac.authorization.k8s.io/v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">kind: ClusterRole</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  name: spark-cluster-role</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">rules:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">- apiGroups: [&quot;&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  resources: [&quot;pods&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;, &quot;create&quot;, &quot;delete&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">- apiGroups: [&quot;&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  resources: [&quot;configmaps&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  verbs: [&quot;get&quot;, &quot;create&quot;, &quot;delete&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">---</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">apiVersion: rbac.authorization.k8s.io/v1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">kind: ClusterRoleBinding</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">metadata:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  name: spark-cluster-role-binding</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">subjects:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">- kind: ServiceAccount</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  name: spark</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">roleRef:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  kind: ClusterRole</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  name: spark-cluster-role</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">  apiGroup: rbac.authorization.k8s.io</span></div><div class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">EOF</span></div></div></div></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Do NOT use <code>ClusterRole</code> and <code>ClusterRoleBinding</code> to run Spark jobs in production, please configure a more fine-grained
security context for running Spark jobs. See more about how to configure proper RBAC rules <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/" target="_blank" rel="noopener noreferrer">here</a>.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="submit-a-spark-job"></a>Submit a Spark job<a aria-hidden="true" tabindex="-1" class="hash-link" href="#submit-a-spark-job" title="Direct link to heading">#</a></h2><p>If this is running from local machine, you will need to start the proxy in order to talk to the api-server.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl proxy</span></div></div></div></div></div><p>Run a simple SparkPi job (this assumes that the Spark binaries are installed to <code>/usr/local</code> directory).</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-shell codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token builtin class-name" style="color:rgb(255, 203, 107)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">SPARK_HOME</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">/usr/local/spark-2.4.4-bin-hadoop2.7/</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">${SPARK_HOME}</span><span class="token plain">/bin/spark-submit --master k8s://http://localhost:8001 --deploy-mode cluster --name spark-pi </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --master k8s://http://localhost:8001 --deploy-mode cluster --name spark-pi </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --class org.apache.spark.examples.SparkPi </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --conf spark.executor.instances</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --conf spark.kubernetes.namespace</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">spark-test </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --conf spark.kubernetes.executor.request.cores</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --conf spark.kubernetes.container.image</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">apache/yunikorn:spark-2.4.4 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   --conf spark.kubernetes.authenticate.driver.serviceAccountName</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">spark </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   local:///opt/spark/examples/jars/spark-examples_2.11-2.4.4.jar</span></div></div></div></div></div><p>You&#x27;ll see Spark driver and executors been created on Kubernetes:</p><p><img alt="spark-pods" src="/assets/images/spark-pods-21a4c799796031460e737650d06d3f7b.png"></p><p>You can also view the job info from YuniKorn UI. If you do not know how to access the YuniKorn UI, please read the document
<a href="/docs/#access-the-web-ui">here</a>.</p><p><img alt="spark-jobs-on-ui" src="/assets/images/spark-jobs-on-ui-21e219c2182fd987302f26a7428b9cac.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="what-happens-behind-the-scenes"></a>What happens behind the scenes?<a aria-hidden="true" tabindex="-1" class="hash-link" href="#what-happens-behind-the-scenes" title="Direct link to heading">#</a></h2><p>When the Spark job is submitted to the cluster, the job is submitted to <code>spark-test</code> namespace. The Spark driver pod will
be firstly created under this namespace. Since this cluster has YuniKorn admission-controller enabled, when the driver pod
get created, the admission-controller mutates the pod&#x27;s spec and injects <code>schedulerName=yunikorn</code>, by doing this, the
default K8s scheduler will skip this pod and it will be scheduled by YuniKorn instead. See how this is done by <a href="https://kubernetes.io/docs/tasks/extend-kubernetes/configure-multiple-schedulers/" target="_blank" rel="noopener noreferrer">configuring
another scheduler in Kubernetes</a>.</p><p>The default configuration has placement rule enabled, which automatically maps the <code>spark-test</code> namespace to a YuniKorn
queue <code>root.spark-test</code>. All Spark jobs submitted to this namespace will be automatically submitted to the queue first.
To see more about how placement rule works, please see doc <a href="/docs/user_guide/placement_rules">placement-rules</a>. By far,
the namespace defines the security context of the pods, and the queue determines how the job and pods will be scheduled
with considering of job ordering, queue resource fairness, etc. Note, this is the simplest setup, which doesn&#x27;t enforce
the queue capacities. The queue is considered as having unlimited capacity.</p><p>YuniKorn reuses the Spark application ID set in label <code>spark-app-selector</code>, and this job is submitted
to YuniKorn and being considered as a job. The job is scheduled and running as there is sufficient resources in the cluster.
YuniKorn allocates the driver pod to a node, binds the pod and starts all the containers. Once the driver pod gets started,
it requests for a bunch of executor pods to run its tasks. Those pods will be created in the same namespace as well and
scheduled by YuniKorn as well.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/user_guide/gang_scheduling"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Gang Scheduling</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/user_guide/workloads/run_flink"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Run Flink Jobs Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prepare-the-docker-image-for-spark" class="table-of-contents__link">Prepare the docker image for Spark</a></li><li><a href="#create-a-namespace-for-spark-jobs" class="table-of-contents__link">Create a namespace for Spark jobs</a></li><li><a href="#submit-a-spark-job" class="table-of-contents__link">Submit a Spark job</a></li><li><a href="#what-happens-behind-the-scenes" class="table-of-contents__link">What happens behind the scenes?</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Blog</h4><ul class="footer__items"><li class="footer__item"><a href="https://blog.cloudera.com/yunikorn-a-universal-resources-scheduler/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s YuniKorn?</a></li><li class="footer__item"><a href="https://blog.cloudera.com/apache-yunikorn-incubating-0-8-release-whats-new-and-upcoming/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s new in YuniKorn 0.8.0?</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Github</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-core</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-k8shim" target="_blank" rel="noopener noreferrer" class="footer__link-item">kubernetes-shim</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-interface</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-web" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-web</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/community/get_involved">Get Involved</a></li><li class="footer__item"><a href="http://people.apache.org/phonebook.html?podling=yunikorn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roster</a></li><li class="footer__item"><a href="https://issues.apache.org/jira/projects/YUNIKORN/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1zJy"><img class="footer__logo" alt="Apache Incubator Logo" src="https://incubator.apache.org/images/incubator_feather_egg_logo.png"></a></div><div>
Copyright Â© 2021 <a href="http://www.apache.org/">The Apache Software Foundation</a>. Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>. <br>
<div style="padding:20px; margin: 10px; color: #4d4d4d;">
  Apache YuniKorn is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the name of Apache TLP sponsor.
  Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications,
  and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily
  a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
</div>
</div></div></div></footer></div>
<script src="/styles.42927ee7.js"></script>
<script src="/runtime~main.1daa9f04.js"></script>
<script src="/main.6222ead5.js"></script>
<script src="/1.f2f38753.js"></script>
<script src="/2.05510059.js"></script>
<script src="/3.a37a1908.js"></script>
<script src="/1be78505.e1f44db4.js"></script>
<script src="/146.37105179.js"></script>
<script src="/9ce8caa5.a08d3d56.js"></script>
<script src="/17896441.6af894f7.js"></script>
<script src="/761be9ac.f481fd70.js"></script>
</body>
</html>