<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.63">
<title data-react-helmet="true">Scheduler Configuration | Apache YuniKorn (Incubating)</title><meta data-react-helmet="true" name="docsearch:version" content="0.10.0,latest"><meta data-react-helmet="true" property="og:image" content="http://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-react-helmet="true" property="twitter:image" content="http://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Apache YuniKorn (Incubating)"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Scheduler Configuration | Apache YuniKorn (Incubating)"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><meta data-react-helmet="true" property="og:url" content="http://yunikorn.apache.org/docs/design/scheduler_configuration"><link data-react-helmet="true" rel="shortcut icon" href="/img/yunikorn.ico"><link data-react-helmet="true" rel="canonical" href="http://yunikorn.apache.org/docs/design/scheduler_configuration"><link rel="stylesheet" href="/styles.3300edef.css">
<link rel="preload" href="/styles.42927ee7.js" as="script">
<link rel="preload" href="/runtime~main.eb375781.js" as="script">
<link rel="preload" href="/main.6222ead5.js" as="script">
<link rel="preload" href="/1.f2f38753.js" as="script">
<link rel="preload" href="/2.05510059.js" as="script">
<link rel="preload" href="/3.a37a1908.js" as="script">
<link rel="preload" href="/1be78505.e1f44db4.js" as="script">
<link rel="preload" href="/146.37105179.js" as="script">
<link rel="preload" href="/9ce8caa5.a08d3d56.js" as="script">
<link rel="preload" href="/17896441.6af894f7.js" as="script">
<link rel="preload" href="/b99ad014.8a34d20e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/yunikorn.ico" alt="YuniKorn Site Logo"><strong class="navbar__title">Apache YuniKorn</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Quick Start</a><a class="navbar__item navbar__link" href="/community/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/community/download">Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/community/get_involved">Get Involved</a></li><li><a class="dropdown__link" position="left" href="/community/how_to_contribute">How to Contribute</a></li><li><a class="dropdown__link" position="left" href="/community/coding_guidelines">Coding Guidelines</a></li><li><a class="dropdown__link" position="left" href="/community/reporting_issues">Reporting Issues</a></li><li><a class="dropdown__link" position="left" href="/community/sessions">Sessions and Demos</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Apache</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Apache Software Foundation</a></li><li><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Apache Incubator</a></li><li><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Apache License</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Sponsorship</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/docs/next/">Master</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" position="left" href="/docs/">0.10.0</a></li><li><a class="dropdown__link" position="left" href="/docs/0.9.0/">0.9.0</a></li><li><a class="dropdown__link" position="left" href="/docs/0.8.0/">0.8.0</a></li></ul></div><a href="https://github.com/apache/incubator-yunikorn-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/yunikorn.ico" alt="YuniKorn Site Logo"><strong class="navbar__title">Apache YuniKorn</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Quick Start</a></li><li class="menu__list-item"><a class="menu__link" href="/community/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/community/download">Download</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/community/get_involved">Get Involved</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/how_to_contribute">How to Contribute</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/coding_guidelines">Coding Guidelines</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/reporting_issues">Reporting Issues</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/sessions">Sessions and Demos</a></li></ul></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">Apache</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Apache Software Foundation</a></li><li class="menu__list-item"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Apache Incubator</a></li><li class="menu__list-item"><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Apache License</a></li><li class="menu__list-item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Sponsorship</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--sublist navbar__link--active" href="/docs">Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/next/">Master</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" position="left" href="/docs/">0.10.0</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/0.9.0/">0.9.0</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/0.8.0/">0.8.0</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/apache/incubator-yunikorn-core" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Get Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/release-announce/0.10.0/">Release Notes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">Get Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/get_started/core_features">Features</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">User Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/queue_config">Partition and Queue Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/placement_rules">App Placement Rules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/sorting_policies">Sorting Policies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/acls">ACLs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/resource_quota_management">Resource Quota Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/gang_scheduling">Gang Scheduling</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Workloads</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/workloads/run_spark">Run Spark Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/workloads/run_flink">Run Flink Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/workloads/run_tf">Run Tensorflow Jobs</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">REST APIs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/cluster">Cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/scheduler">Scheduler</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/api/system">System</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/user_guide/trouble_shooting">Trouble Shooting</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Developer Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/env_setup">Dev Environment Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/build">Build and Run</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/deployment">Deploy to Kubernetes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer_guide/openshift_development">Development in CodeReady Containers</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Designs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/architecture">Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/scheduler_core_design">Scheduler Core Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/cache_removal">Scheduler cache removal design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/k8shim">Kubernetes Shim Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/cross_queue_preemption">Cross Queue Preemption</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/namespace_resource_quota">Namespace Resource Quota</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/pluggable_app_management">Pluggable App Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/resilience">Resilience</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/predicates">Support K8s Predicates</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/design/scheduler_configuration">Scheduler Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/state_aware_scheduling">Batch Workloads Ordering with StateAware Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/design/scheduler_object_states">Scheduler Object States</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Performance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/performance/evaluate_perf_function_with_kubemark">Evaluate YuniKorn function &amp; performance with Kubemark</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/performance/metrics">Scheduler Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/performance/profiling">Profiling</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: 0.10.0</span></div><header><h1 class="docTitle_1Lrw">Scheduler Configuration</h1></header><div class="markdown"><p>The Yunikorn core scheduler configuration has two separate areas that need to be configured. The scheduler service itself, things like web service ports etc, and the queue configuration. The split between the two types of configuration is proposed with two points in mind:</p><ul><li>Separation of duty</li><li>Dynamic vs Static</li></ul><p>The scheduler configuration is mainly static. There is no need to change a web service port or a scheduling policy while the service is running. The queue configuration is far more dynamic and can change while the service is running.</p><p>From a separation of duty we can allow an operator that manages the cluster to make changes to the scheduler queues. You would not want to allow that administrator to change the scheduler configuration itself.</p><p>Separated from the core scheduler configuration we have one or more shim configurations. We currently cannot anticipate the deployment model of the scheduler and its shims. A shim, like the k8s-shim, might run in the same container or node but there is no guarantee it will. We also do not know the number of shims that will be used with one core scheduler. There is also still the possibility to have multiple instances of the same shim with one core scheduler.</p><p>Shim configuration must be independent of the core scheduler configuration.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="scheduler-configuration"></a>Scheduler Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#scheduler-configuration" title="Direct link to heading">#</a></h2><p>Scheduler configuration covers all the configuration needed to start the scheduler and the dependent services. The configuration consists of a simple key value pair. All configuration to start the service must be part of this configuration.
The scheduler configuration must exclude the queue related configuration.</p><p>Scheduler configuration as currently identified</p><ul><li>Bind host</li><li>Service port</li><li>Web bind host</li><li>Web service port</li><li>SSL config</li><li>Shims Configured</li><li>SchedulerACL</li></ul><p>Configuration to consider:</p><ul><li>Assign multiple containers in one go: use case is bin packing, don’t spread an application over large number of nodes. Needs to become configurable.</li><li>Pre-emption related configuration:<ul><li>threshold: do not pre-empt from a queue if the cluster load is below a certain threshold.</li><li>Interval: pause between pre-emption checks</li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="queue-configuration"></a>Queue Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#queue-configuration" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="queue-definition"></a>Queue Definition<a aria-hidden="true" tabindex="-1" class="hash-link" href="#queue-definition" title="Direct link to heading">#</a></h3><p>On startup the scheduler will load the configuration for the queues from the provided configuration file after initialising the service. If there is no queue configuration provided the scheduler should start up with a simple default configuration which performs a well documented default behaviour.
Based on the kubernetes definition this configuration could be a configMap <sup id="s1"><a href="#f1">1</a></sup> but not a CRD.</p><p>The queue configuration is dynamic. Changing the queue configuration must not require a scheduler restart.
Changes should be allowed by either calling the GO based API, the REST based API or by updating the configuration file. Changes made through the API must be persisted in the configuration file. Making changes through an API is not a high priority requirement and could be postponed to a later release.</p><p>The queue configuration defines queues in a hierarchy: a tree. The base of the tree is the <em>root</em> queue. The queue configuration must define a single <em>root</em> queue. All queues that are defined in queue configuration are considered <em>managed</em> queues.</p><p>The root queue reflect the whole cluster. Resource settings on the root queue are not allowed. The resources available to the root queue are calculated based on the registered node resources in the cluster. If resources would be specified on the root limit the cluster would either be artificially limited to a specific size or expect resources to be available that are not there.</p><p>Queues in the hierarchy in the tree are separated by the “.” dot character (ASCII 0x2E). This indirectly means that a queue name itself cannot contain a dot as it interferes with the hierarchy separator. Any queue name in the configuration that contains a dot will cause the configuration to be considered invalid. However we must allow placement rules to create a queue with a dot based input.</p><p>Not all queues can be used to submit an application to. Applications can only be submitted to a queue which does not have a queue below it. These queues are defined as the <em>leaf</em> queues of the tree. Queues that are not a <em>leaf</em> and thus can contain other queues or child queues are considered <em>parent</em> queues.</p><p>Each queue must have exactly one <em>parent</em> queue, besides the root queue. The root queue cannot have a <em>parent</em> and will be automatically defined as a <em>parent</em> queue type.
A fully qualified queue name, case insensitive, must be unique in the hierarchy. A queue in the hierarchy can thus be only uniquely identified by its fully qualified path. This means that a queue with the same name is allowed at a different point in the hierarchy.
Example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">root.companyA.development</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">root.companyB.development</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">root.production.companyA</span></div></div></div></div></div><p>In the example the queues <em>companyA</em> and <em>companyB</em> are <em>parent</em> queues. Both <em>development</em> queues are <em>leaf</em> queues.
The second instance of the <em>companyA</em> queue is a <em>leaf</em> queue which is not related to the first instance as it is defined at a different level in the hierarchy.</p><p>The queue as defined in the configuration will be assigned a queue type. This can either be implicit based on how the queue is defined in the hierarchy or explicit by setting the optional <em>parent</em> property as part of the queue definition. By default all queues will be assigned their type based on the configuration. There is only one case in which this should automatic process would need to be overridden and that is to mark a <em>leaf</em> in the configuration as a <em>parent</em>. The use case is part of the <a href="#placement-rules-definition">placement rules</a>. In that case the configuration could be used to define a <em>parent</em> queue for only <em>unmanaged</em> queues.</p><p>Access control lists provide a split between submission permission and administration permissions. Submission access to a queue allows an application to be submitted to the queue by the users or groups specified. The administration permissions allows submission to the queue plus the administrative actions. Administrative actions are currently limited to killing an application and moving an application to a different queue.</p><p>Access control lists are checked recursively up to the root of the tree starting at the lowest point in the tree. In other words when the access control list of a queue does not allow access the parent queue is checked. The checks are repeated all the way up to the root of the queues.</p><p>On each queue, except the root queue, the following properties can be set:</p><ul><li>QueueType:<ul><li>Parent (boolean)</li></ul></li><li>Resource settings:<ul><li>Guaranteed (resource)</li><li>Maximum (resource)</li></ul></li><li>Running Application limit:<ul><li>Maximum (integer)</li></ul></li><li>Queue Permissions:<ul><li>SubmitACL (ACL)</li><li>AdminACL (ACL)</li></ul></li><li>Pre emption setting:<ul><li>PreEmptionAllowed (boolean)</li></ul></li><li>Application sort algorithm:<ul><li>ApplicationSortPolicy (enumeration: fair, fifo)</li></ul></li></ul><p>On the root queue only the following properties can be set:</p><ul><li>Running Application limit:<ul><li>Maximum (integer)</li></ul></li><li>Queue Permissions:<ul><li>SubmitACL (ACL)</li><li>AdminACL (ACL)</li></ul></li><li>Application sort algorithm:<ul><li>ApplicationSortPolicy (enumeration: fair, fifo)</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="user-definition"></a>User definition<a aria-hidden="true" tabindex="-1" class="hash-link" href="#user-definition" title="Direct link to heading">#</a></h3><p>Applications are run by a user could run in one or more queues. The queues can have limits set on the resources that can be used. This does not limit the amount of resources that can be used by the user in the cluster.</p><p>From an administrative perspective setting a limit of the resources that can be used by a specific user can be important.  In this case a user is broadly defined as the identity that submits the application. This can be a service or a person, from a scheduling perspective there is no difference.
User limits can prevent a take over of a queue or the cluster by a misbehaving user or application. From a multi tenancy perspective user limits also allows for sharing or subdivision of resources within the tenancy however that is defined.</p><p>Adding user based limits will allow the cluster administrators to control the cluster wide resource usage of a user:</p><ul><li>Running Application limit:<ul><li>Maximum (integer)</li></ul></li><li>Resource setting:<ul><li>Maximum (resource)</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="placement-rules-definition"></a>Placement Rules definition<a aria-hidden="true" tabindex="-1" class="hash-link" href="#placement-rules-definition" title="Direct link to heading">#</a></h3><p>Schedulers can place an application in a queue dynamically. This means that an application when submitted does not have to include a queue to run in.</p><p>A placement rule will use the application details to place the application in the queue. The outcome of running a placement rule will be a fully qualified queue or a <code>fail</code>, which means execute the next rule in the list. Rules will be executed in the order that they are defined.</p><p>During the evaluation of the rule the result could be a queue name that contains a dot. This is especially true for user and group names which are POSIX compliant. When a rule generates a partial queue name that contains a dot it must be replaced as it is the separator in the hierarchy. The replacement text will be <code>_dot_</code></p><p>The first rule that matches, i.e. returns a fully qualified queue name, will halt the execution of the rules. If the application is not placed at the end of the list of rules the application will be rejected. Rules can return queues that are not defined in the configuration only if the rule allows creation of queues.</p><p>These queues created by the placement rules are considered <em>unmanaged</em> queues as they are not managed by the administrator in the configuration. An administrator cannot influence the <em>unmanaged</em> queue creation or deletion. The scheduler creates the queue when it is needed and removes the queue automatically when it is no longer used.</p><p>Rules provide a fully qualified queue name as the result. To allow for deeper nesting of queues the parent of the queue can be set as part of the rule evaluation. The rule definition should allow a fixed configured fully qualified parent to be specified or it can call a second rule to generate the parent queue.  By default a queue is generated as a child of the root queue.</p><p>Example:
Placing an application submitted by the user <em>user1</em> whom is a member of the groups <em>user1</em> and <em>companyA</em> in a queue based on UserName:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Rule name: UserName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Parent: root.fixedparent</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Result: root.fixedparent.user1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Rule name: UserName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Parent: SecondaryGroup</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Filter:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Type: allow</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Groups: company.*</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Result: root.companyA.user1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Rule name: UserName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Filter:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Users: user2,user3</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Result: denied placement</span></div></div></div></div></div><p>The default behaviour for placing an application in a queue, which would do the same as using the queue that is provided during submit, would be a rule that takes the provided queue with the create flag set to false.</p><p>Access permissions will be enforced as part of the rule evaluation. For <em>managed</em> queues this means that the ACL for the queue itself is checked. For an <em>unmanaged</em> queue the parent queue ACL is the one that is checked. For the definition of the access control list and checks see the <a href="#access-control-lists">Access Control Lists</a> chapter.</p><p>Defining placement rules in the configuration requires the following information per rule:</p><ul><li>Name:<ul><li>Name (string)</li></ul></li><li>Parent<ul><li>Parent (string)</li></ul></li><li>Create Flag:<ul><li>Create (boolean)</li></ul></li><li>Filter:<ul><li>A regular expression or list of users/groups to apply the rule to.</li></ul></li></ul><p>The filter can be used to allow the rule to be used (default behaviour) or deny the rule to be used. User or groups matching the filter will be either allowed or denied.
The filter is defined as follow:</p><ul><li>Type:<ul><li>Type (string) which can have no value (empty) or &quot;allow&quot; or &quot;deny&quot;, case insensitive.</li></ul></li><li>Users:<ul><li>A list of zero or more user names. If the list is exactly one long it will be interpreted as a regular expression.</li></ul></li><li>Groups:<ul><li>A list of zero or more group names. If the list is exactly one long it will be interpreted as a regular expression.</li></ul></li></ul><p>Proposed rules for placing applications would be:</p><ul><li>Provided: returns the queue provided during the submission</li><li>UserName: returns the user name</li><li>PrimaryGroupName: returns the primary group of the user</li><li>SecondaryGroupName: returns the first secondary group of the user that matches</li><li>Fixed: returns the queue name configured in the rule</li><li>ApplicationType: returns the application type (if available)</li></ul><p>For <em>unmanaged</em> queues in the current revision of the configuration you cannot provide any queue specific properties. However in the future we should consider propagating specific resource related settings from a <em>managed</em> parent to the <em>unmanaged</em> child, specifically:</p><ul><li>Dynamic Resource settings:<ul><li>Guaranteed (resource)</li><li>Maximum (resource)</li></ul></li><li>Dynamic Running Application limit:<ul><li>Maximum (integer)</li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuration-updates"></a>Configuration updates<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configuration-updates" title="Direct link to heading">#</a></h3><p>Updating the queue definition will allow updating the existing queue properties as well as adding and removing queues. A new queue definition will only become active if the configuration can be parsed. The change of the definition is an atomic change which applies all modification in one action.</p><p>Updating the queue properties will not automatically trigger further action. This means that if the maximum number of resources of a queue or its parent is changed we leave the applications in the queue running as they are. The scheduler will adhere to the new property values which should see the convergence over time.</p><p>A <em>managed</em> queue will only be removed if it is removed from the configuration. Before we can remove a queue it must not be running applications. This means that when a <em>managed</em> queue is removed from the configuration it must be empty or the system needs to allow the queue to drain. Forcing a <em>managed</em> queue to be empty before we can remove it is not possible which means that <em>managed</em> queues are removed in multiple steps:</p><ol><li>The queue is removed from the configuration</li><li>The queue is marked as <code>draining</code></li><li>All managed queues that are <code>draining</code> and empty are removed</li></ol><p>Long running applications should be handled gracefully when removing a <em>managed</em> queue. The scheduler should at least track and expose that a queue has been in a <em>draining</em> state for an extended period of time. In the optimal case the application should be notified of the queue change to allow it to release resources. In all cases the queue administrators should be notified to allow them to take action. This action would currently be a manual move of the application to a different queue by the administrators.</p><p><em>Unmanaged</em> queues that are not defined in the queue definition are created by the scheduler automatically based on the placement rules. <em>Unmanaged</em> queues have a lifespan independent of the configuration. Whenever an <em>unmanaged</em> queue is empty it will get removed. The queue will automatically be created again when a new application is requesting it via triggering the placement rule.</p><p>Removing an empty <em>managed</em> or <em>unmanaged</em> queue is handled by the same removal code which must run independent of the configuration updates and scheduling actions.</p><p>Configurations can change over time. The impact of a fail over or restart must still be investigated.
Base point to make: a changed configuration should not impact the currently running applications. Queues that no longer exist should be handled somehow.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="access-control-lists"></a>Access Control Lists<a aria-hidden="true" tabindex="-1" class="hash-link" href="#access-control-lists" title="Direct link to heading">#</a></h3><p>The scheduler ACL is independent of the queue ACLs. A scheduler administrator is not by default allowed to submit an application or administer the queues in the system.</p><p>All ACL types should use the same definition pattern. We should allow at least POSIX user and group names which uses the portable filename character set <sup id="s2"><a href="#f2">2</a></sup>. However we should take into account that we could have domain specifiers based on the environment that the system runs in (@ sign as per HADOOP-12751).</p><p>By default access control is enabled and access is denied. The only special case is for the core scheduler which automatically adds the system user, the scheduler process owner, to the scheduler ACL. The scheduler process owner is allowed to make sure that the process owner can use the API to call any administrative actions.</p><p>Access control lists give access to the users and groups that have been specified in the list. They do not provide the possibility to explicitly remove or deny access to the users and groups specified in the list.</p><p>The access control list is defined as:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ACL ::= “*” |  userlist [ “ “ grouplist ]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">userlist ::= “” | user { “,” user }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">grouplist ::= “” | group { “,” group }</span></div></div></div></div></div><p>This definition specifies a wildcard of * which results in access for everyone. If the user list is empty and the group list is empty nobody will have access. This deny all ACL has two possible representations:</p><ul><li>an empty access control list.</li><li>a single space.</li></ul><p>If there is no access control list is configured access is denied by default.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="shim-configuration"></a>Shim Configuration<a aria-hidden="true" tabindex="-1" class="hash-link" href="#shim-configuration" title="Direct link to heading">#</a></h2><p>The shim configuration is highly dependent on the shim implementation. The k8s shim differs from the YARN shim. Currently the k8s shim is configured via command line options but we should not depend on that.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="k8s-shim"></a>K8s shim<a aria-hidden="true" tabindex="-1" class="hash-link" href="#k8s-shim" title="Direct link to heading">#</a></h3><p>The full configuration of the K8s shim is still under development.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="yarn-shim"></a>YARN shim<a aria-hidden="true" tabindex="-1" class="hash-link" href="#yarn-shim" title="Direct link to heading">#</a></h3><p>The full configuration of the YARN shim is still under development.</p><hr><br><b id="f1"></b>1: https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#should-i-use-a-configmap-or-a-custom-resource. [↩](#s1)<br><b id="f2"></b>2: The set of characters from which portable filenames are constructed. [↩](#s2)<br>`A B C D E F G H I J K L M N O P Q R S T U V W X Y Z a b c d e f g h i j k l m n o p q r s t u v w x y z 0 1 2 3 4 5 6 7 8 9 . _ -`</div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/design/predicates"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Support K8s Predicates</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/design/state_aware_scheduling"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Batch Workloads Ordering with StateAware Policy »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#scheduler-configuration" class="table-of-contents__link">Scheduler Configuration</a></li><li><a href="#queue-configuration" class="table-of-contents__link">Queue Configuration</a><ul><li><a href="#queue-definition" class="table-of-contents__link">Queue Definition</a></li><li><a href="#user-definition" class="table-of-contents__link">User definition</a></li><li><a href="#placement-rules-definition" class="table-of-contents__link">Placement Rules definition</a></li><li><a href="#configuration-updates" class="table-of-contents__link">Configuration updates</a></li><li><a href="#access-control-lists" class="table-of-contents__link">Access Control Lists</a></li></ul></li><li><a href="#shim-configuration" class="table-of-contents__link">Shim Configuration</a><ul><li><a href="#k8s-shim" class="table-of-contents__link">K8s shim</a></li><li><a href="#yarn-shim" class="table-of-contents__link">YARN shim</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Blog</h4><ul class="footer__items"><li class="footer__item"><a href="https://blog.cloudera.com/yunikorn-a-universal-resources-scheduler/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s YuniKorn?</a></li><li class="footer__item"><a href="https://blog.cloudera.com/apache-yunikorn-incubating-0-8-release-whats-new-and-upcoming/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s new in YuniKorn 0.8.0?</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Github</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-core</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-k8shim" target="_blank" rel="noopener noreferrer" class="footer__link-item">kubernetes-shim</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-interface</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-web" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-web</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/community/get_involved">Get Involved</a></li><li class="footer__item"><a href="http://people.apache.org/phonebook.html?podling=yunikorn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roster</a></li><li class="footer__item"><a href="https://issues.apache.org/jira/projects/YUNIKORN/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1zJy"><img class="footer__logo" alt="Apache Incubator Logo" src="https://incubator.apache.org/images/incubator_feather_egg_logo.png"></a></div><div>
Copyright © 2021 <a href="http://www.apache.org/">The Apache Software Foundation</a>. Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>. <br>
<div style="padding:20px; margin: 10px; color: #4d4d4d;">
  Apache YuniKorn is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the name of Apache TLP sponsor.
  Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications,
  and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily
  a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
</div>
</div></div></div></footer></div>
<script src="/styles.42927ee7.js"></script>
<script src="/runtime~main.eb375781.js"></script>
<script src="/main.6222ead5.js"></script>
<script src="/1.f2f38753.js"></script>
<script src="/2.05510059.js"></script>
<script src="/3.a37a1908.js"></script>
<script src="/1be78505.e1f44db4.js"></script>
<script src="/146.37105179.js"></script>
<script src="/9ce8caa5.a08d3d56.js"></script>
<script src="/17896441.6af894f7.js"></script>
<script src="/b99ad014.8a34d20e.js"></script>
</body>
</html>