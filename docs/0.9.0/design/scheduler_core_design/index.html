<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.63">
<title data-react-helmet="true">Scheduler Core Design | Apache YuniKorn (Incubating)</title><meta data-react-helmet="true" name="docsearch:version" content="0.9.0"><meta data-react-helmet="true" property="og:image" content="http://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-react-helmet="true" property="twitter:image" content="http://yunikorn.apache.org/img/logo/yunikorn-logo-main.png"><meta data-react-helmet="true" name="twitter:image:alt" content="Image for Apache YuniKorn (Incubating)"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Scheduler Core Design | Apache YuniKorn (Incubating)"><meta data-react-helmet="true" name="description" content="&lt;!--"><meta data-react-helmet="true" property="og:description" content="&lt;!--"><meta data-react-helmet="true" property="og:url" content="http://yunikorn.apache.org/docs/0.9.0/design/scheduler_core_design"><link data-react-helmet="true" rel="shortcut icon" href="/img/yunikorn.ico"><link data-react-helmet="true" rel="canonical" href="http://yunikorn.apache.org/docs/0.9.0/design/scheduler_core_design"><link rel="stylesheet" href="/styles.3300edef.css">
<link rel="preload" href="/styles.42927ee7.js" as="script">
<link rel="preload" href="/runtime~main.1daa9f04.js" as="script">
<link rel="preload" href="/main.6222ead5.js" as="script">
<link rel="preload" href="/1.f2f38753.js" as="script">
<link rel="preload" href="/2.05510059.js" as="script">
<link rel="preload" href="/3.a37a1908.js" as="script">
<link rel="preload" href="/1be78505.e1f44db4.js" as="script">
<link rel="preload" href="/146.37105179.js" as="script">
<link rel="preload" href="/9a6d52da.085a8bc2.js" as="script">
<link rel="preload" href="/17896441.6af894f7.js" as="script">
<link rel="preload" href="/b8c87182.22e9f1cb.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/yunikorn.ico" alt="YuniKorn Site Logo"><strong class="navbar__title">Apache YuniKorn</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Quick Start</a><a class="navbar__item navbar__link" href="/community/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/community/download">Download</a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/community/get_involved">Get Involved</a></li><li><a class="dropdown__link" position="left" href="/community/how_to_contribute">How to Contribute</a></li><li><a class="dropdown__link" position="left" href="/community/coding_guidelines">Coding Guidelines</a></li><li><a class="dropdown__link" position="left" href="/community/reporting_issues">Reporting Issues</a></li><li><a class="dropdown__link" position="left" href="/community/sessions">Sessions and Demos</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Apache</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Apache Software Foundation</a></li><li><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Apache Incubator</a></li><li><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Apache License</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link" position="left">Sponsorship</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" position="left" href="/docs/next/">Master</a></li><li><a class="dropdown__link" position="left" href="/docs/">0.10.0</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" position="left" href="/docs/0.9.0/">0.9.0</a></li><li><a class="dropdown__link" position="left" href="/docs/0.8.0/">0.8.0</a></li></ul></div><a href="https://github.com/apache/incubator-yunikorn-core" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/yunikorn.ico" alt="YuniKorn Site Logo"><strong class="navbar__title">Apache YuniKorn</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/">Quick Start</a></li><li class="menu__list-item"><a class="menu__link" href="/community/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/community/download">Download</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">Community</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/community/get_involved">Get Involved</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/how_to_contribute">How to Contribute</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/coding_guidelines">Coding Guidelines</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/reporting_issues">Reporting Issues</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/community/sessions">Sessions and Demos</a></li></ul></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" class="menu__link menu__link--sublist">Apache</a><ul class="menu__list"><li class="menu__list-item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Apache Software Foundation</a></li><li class="menu__list-item"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Apache Incubator</a></li><li class="menu__list-item"><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Apache License</a></li><li class="menu__list-item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="menu__link" position="left">Sponsorship</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--sublist navbar__link--active" href="/docs">Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/next/">Master</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/">0.10.0</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" position="left" href="/docs/0.9.0/">0.9.0</a></li><li class="menu__list-item"><a class="menu__link" position="left" href="/docs/0.8.0/">0.8.0</a></li></ul></li><li class="menu__list-item"><a href="https://github.com/apache/incubator-yunikorn-core" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Get Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/release-announce/0.9.0/">Release Notes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/">Get Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/get_started/core_features">Features</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">User Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/user_guide/queue_config">Partition and Queue Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/user_guide/placement_rules">App Placement Rules</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/user_guide/sorting_policies">Sorting Policies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/user_guide/acls">ACLs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/user_guide/resource_quota_management">Resource Quota Management</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Workloads</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/user_guide/workloads/run_spark">Run Spark Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/user_guide/workloads/run_flink">Run Flink Jobs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/user_guide/workloads/run_tf">Run Tensorflow Jobs</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">REST APIs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/api/cluster">Cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/api/scheduler">Scheduler</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/api/system">System</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/user_guide/trouble_shooting">Trouble Shooting</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Developer Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.9.0/developer_guide/env_setup">Dev Environment Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.9.0/developer_guide/build">Build and Run</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.9.0/developer_guide/deployment">Deploy to Kubernetes</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Designs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.9.0/design/architecture">Architecture</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/0.9.0/design/scheduler_core_design">Scheduler Core Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.9.0/design/k8shim">Kubernetes Shim Design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.9.0/design/cross_queue_preemption">Cross Queue Preemption</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.9.0/design/namespace_resource_quota">Namespace Resource Quota</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.9.0/design/pluggable_app_management">Pluggable App Management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.9.0/design/resilience">Resilience</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.9.0/design/predicates">Support K8s Predicates</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.9.0/design/scheduler_configuration">Scheduler Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.9.0/design/state_aware_scheduling">Batch Workloads Ordering with StateAware Policy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/0.9.0/design/scheduler_object_states">Scheduler Object States</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Performance</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/performance/evaluate_perf_function_with_kubemark">Evaluate YuniKorn function &amp; performance with Kubemark</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/performance/metrics">Scheduler Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/0.9.0/performance/profiling">Profiling</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for Apache YuniKorn (Incubating) <strong>0.9.0</strong>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <strong><a href="/docs/design/scheduler_core_design">latest version</a></strong> (0.10.0).</div></div><div class="docItemContainer_3QWW"><article><div><span class="badge badge--secondary">Version: 0.9.0</span></div><header><h1 class="docTitle_1Lrw">Scheduler Core Design</h1></header><div class="markdown"><p>Github repo: <a href="https://github.com/apache/incubator-yunikorn-core/" target="_blank" rel="noopener noreferrer">https://github.com/apache/incubator-yunikorn-core/</a></p><p>Scheduler core encapsulates all scheduling algorithms, it collects resources from underneath resource management
platforms (like YARN/K8s), and is responsible for container allocation requests. It makes the decision where is the
best spot for each request and then sends response allocations to the resource management platform.
Scheduler core is agnostic about underneath platforms, all the communications are through the <a href="https://github.com/apache/incubator-yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer">scheduler interface</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="components"></a>Components:<a aria-hidden="true" tabindex="-1" class="hash-link" href="#components" title="Direct link to heading">#</a></h2><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                     +---------------+  +--------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                     |K8s Shim       |  |YARN Shim     |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                     +---------------+  +--------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                +--------------+   +------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                Scheduler-      | GRPC Protocol|   |Go API      |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                Interface:      +--------------+   +------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">+---------------------------------------------------------------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                     +--------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                     |Scheduler API Server|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> +-------------+     +---------+----------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |AdminService |               |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> +-------------+               |Write Ops                    +----------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> +-------------+               V                            ++Scheduler       |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> |Configurator |      +-------------------+  Allocate       ||   And          |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> +-------------+      |Cache Event Handler+&lt;-----------------|                |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         +----------&gt; +-------------------+  Preempt        ++Preemptor       |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          Update Cfg   Handled by policies                   +----------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                               +  (Stateless)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        +------v--------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        |Scheduler Cache|</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        +---------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                +---------------------------------------------+</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                |--------+ +------+ +----------+ +----------+ |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                ||Node   | |Queue | |Allocation| |Requests  | |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                |--------+ +------+ +----------+ +----------+ |</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                +---------------------------------------------+</span></div></div></div></div></div><p>###Scheduler API Server (RMProxy)</p><p>Responsible for communication between RM and Scheduler, which implements scheduler-interface GRPC protocol,
or just APIs. (For intra-process communication w/o Serde).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="scheduler-cache"></a>Scheduler Cache<a aria-hidden="true" tabindex="-1" class="hash-link" href="#scheduler-cache" title="Direct link to heading">#</a></h3><p>Caches all data related to scheduler state, such as used resources of each queues, nodes, allocations.
Relationship between allocations and nodes, etc. Should not include in-flight data for resource allocation.
For example to-be-preempted allocation candidates. Fair share resource of queues, etc.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="scheduler-cache-event-handler"></a>Scheduler Cache Event Handler<a aria-hidden="true" tabindex="-1" class="hash-link" href="#scheduler-cache-event-handler" title="Direct link to heading">#</a></h3><p>Handles all events which needs to update scheduler internal state. So all the write operations will be carefully handled.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="admin-service"></a>Admin Service<a aria-hidden="true" tabindex="-1" class="hash-link" href="#admin-service" title="Direct link to heading">#</a></h3><p>Handles request from Admin, which can also load configurations from storage and update scheduler policies.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="scheduler-and-preemptor"></a>Scheduler and Preemptor<a aria-hidden="true" tabindex="-1" class="hash-link" href="#scheduler-and-preemptor" title="Direct link to heading">#</a></h3><p>Handles Scheduler&#x27;s internal state. (Which is not belong to scheduelr cache), such as internal reservations, etc.
Scheduler and preemptor will work together, make scheduling or preemption decisions. All allocate/preempt request
will be handled by event handler.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="schedulers-responsibility"></a>Scheduler&#x27;s responsibility<a aria-hidden="true" tabindex="-1" class="hash-link" href="#schedulers-responsibility" title="Direct link to heading">#</a></h2><ul><li>According to resource usages between queues, sort queues, applications, and figure out order of application allocation. (This will be used by preemption as well).</li><li>It is possible that we cannot satisfy some of the allocation request, we need to skip them and find next request.</li><li>It is possible that some allocation request cannot be satisfied because of resource fragmentation. We need to reserve room for such requests.</li><li>Different nodes may belong to different disjoint partitions, we can make independent scheduler runs</li><li>Be able to config and change ordering policies for apps, queues.</li><li>Application can choose their own way to manage sort of nodes.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="preemption"></a>Preemption<a aria-hidden="true" tabindex="-1" class="hash-link" href="#preemption" title="Direct link to heading">#</a></h2><ul><li>It is important to know &quot;who wants the resource&quot;, so we can do preemption based on allocation orders.</li><li>When do preemption, it is also efficient to trigger allocation op. Think about how to do it.</li><li>Preemption needs to take care about queue resource balancing.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="communication-between-shim-and-core"></a>Communication between Shim and Core<a aria-hidden="true" tabindex="-1" class="hash-link" href="#communication-between-shim-and-core" title="Direct link to heading">#</a></h2><p>YuniKorn-Shim (like <a href="https://github.com/apache/incubator-yunikorn-k8shim" target="_blank" rel="noopener noreferrer">https://github.com/apache/incubator-yunikorn-k8shim</a>) communicates with core by
using scheduler-interface (<a href="https://github.com/apache/incubator-yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer">https://github.com/apache/incubator-yunikorn-scheduler-interface</a>).
Scheduler interface has Go API or GRPC. Currently, yunikorn-k8shim is using Go API to communicate with yunikorn-core
to avoid extra overhead introduced by GRPC. </p><p><strong>Shim (like K8shim) first need to register with core:</strong> </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">m </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">RMProxy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">RegisterResourceManager</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">request </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">si</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RegisterResourceManagerRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> callback api</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ResourceManagerCallback</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">si</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">RegisterResourceManagerResponse</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><p>Which indicate ResourceManager&#x27;s name, a callback function for updateResponse. The design of core is be able to do scheduling for multiple clusters (such as multiple K8s cluster) just with one core instance.</p><p><strong>Shim interacts with core by invoking RMProxy&#x27;s Update API frequently, which updates new allocation request, allocation to kill, node updates, etc.</strong> </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">m </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">RMProxy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">Update</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">request </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">si</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">UpdateRequest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(130, 170, 255)">error</span></div></div></div></div></div><p>Response of update (such as new allocated container) will be received by registered callback.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configurations--semantics"></a>Configurations &amp; Semantics<a aria-hidden="true" tabindex="-1" class="hash-link" href="#configurations--semantics" title="Direct link to heading">#</a></h2><p>Example of configuration:</p><ul><li><p>Partition is name space.</p></li><li><p>Same queues can under different partitions, but enforced to have same hierarchy.</p><p>  Good:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> partition=x    partition=y</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     a           a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   /   \        / \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  b     c      b   c</span></div></div></div></div></div><p>  Good (c in partition y acl=&quot;&quot;):</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> partition=x    partition=y</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     a           a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   /   \        /</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  b     c      b</span></div></div></div></div></div><p>  Bad (c in different hierarchy)</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> partition=x    partition=y</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     a           a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   /   \        /  \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  b     c      b    d</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              /</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             c</span></div></div></div></div></div><p>  Bad (Duplicated c)</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"> partition=x</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   /   \</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  b     c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> /</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div></li><li><p>Different hierarchies can be added</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-scheduler-conf.yaml codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">partitions:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - name:  default</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    queues:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        root:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          configs:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            acls:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          childrens:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            - a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            - b</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            - c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            - ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        a:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          configs:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            acls:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            capacity: (capacity is not allowed to set for root)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            max-capacity: ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      mapping-policies:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: partition_a:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    queues:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        root:...</span></div></div></div></div></div></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="how-scheduler-do-allocation"></a>How scheduler do allocation<a aria-hidden="true" tabindex="-1" class="hash-link" href="#how-scheduler-do-allocation" title="Direct link to heading">#</a></h2><p>Scheduler runs a separate goroutine to look at asks and available resources, and do resource allocation. Here&#x27;s allocation logic in pseudo code: </p><p>Entry point of scheduler allocation is <code>scheduler.go: func (s *Scheduler) schedule()</code></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># First of all, YuniKorn has partition concept, a logical resource pool can consists</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># of one of multiple physical dis-joint partitions. It is similar to YARN&#x27;s node</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># partition concept.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">for partition : partitions:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # YuniKorn can reserve allocations for picky asks (such as large request, etc.)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # Before doing regular allocation, YuniKorn look at reservedAllocations first.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  for reservedAllocation : partition.reservedAllocations: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     reservedAllocation.tryAllocate(..)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # After tried all reserved allocation, YuniKorn will go to regular allocation</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  partition.tryAllocate(..)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # If there&#x27;s any allocation created, scheduler will create an AllocationProposal</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  # and send to Cache to &quot;commit&quot; the AllocationProposal </span></div></div></div></div></div><p><strong>Allocation by hierchical of queues</strong></p><p>Inside <code>partition.tryAllocate</code> </p><p>It recursively traverse from root queue and down to lower level, for each level, logic is inside <code>pkg/scheduler/scheduling_queue.go func (sq *SchedulingQueue) tryAllocate</code></p><p>Remember YuniKorn natively supports hierarchical of queues. For ParentQueue (which has sub queues under the parent queue), it uses queue&#x27;s own sorting policy to sort subqueues and try to allocate from most preferred queue to least-preferred queue. </p><p>For LeafQueue (which has applications inside the queue), it uses queue&#x27;s own sorting policy to sort applications belong to the queue and allocate based on the sorted order. </p><p>(All sorting policies can be configured differently at each level.) </p><p><strong>Allocation by application</strong></p><p>When it goes to Application, see (<code>scheduler_application.go: func (sa *SchedulingApplication) tryAllocate</code>), It first sort the pending resource requests belong to the application (based on requests&#x27; priority). And based on the selected request, and configured node-sorting policy, it sorts nodes belong to the partition and try to allocate resources on the sorted nodes. </p><p>When application trying to allocate resources on nodes, it will invokes PredicatePlugin to make sure Shim can confirm the node is good. (For example K8shim runs predicates check for allocation pre-check).</p><p><strong>Allocation completed by scheduler</strong> </p><p>Once allocation is done, scheduler will create an AllocationProposal and send to Cache to do further check, we will cover details in the upcoming section.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="flow-of-events"></a>Flow of events<a aria-hidden="true" tabindex="-1" class="hash-link" href="#flow-of-events" title="Direct link to heading">#</a></h2><p>Like mentioned before, all communications between components like RMProxy/Cache/Schedulers are done by using async event handler. </p><p>RMProxy/Cache/Scheduler include local event queues and event handlers. RMProxy and Scheduler have only one queue (For example: <code>pkg/scheduler/scheduler.go: handleSchedulerEvent</code>), and Cache has two queues (One for events from RMProxy, and one for events from Scheduler, which is designed for better performance). </p><p>We will talk about how events flowed between components: </p><p><strong>Events for ResourceManager registration and updates:</strong></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Update from ResourceManager -&gt; RMProxy -&gt; RMUpdateRequestEvent Send to Cache</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">New ResourceManager registration -&gt; RMProxy -&gt; RegisterRMEvent Send to Cache</span></div></div></div></div></div><p><strong>Cache Handles RM Updates</strong> </p><p>There&#x27;re many fields inside RM Update event (<code>RMUpdateRequestEvent</code>), among them, we have following categories: </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">1) Update for Application-related updates</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2) Update for New allocation ask and release. </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">3) Node (Such as kubelet) update (New node, remove node, node resource change, etc.)</span></div></div></div></div></div><p>More details can be found at: </p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">func (m *ClusterInfo) processRMUpdateEvent(event *cacheevent.RMUpdateRequestEvent)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">inside cluster_info.go</span></div></div></div></div></div><p><strong>Cache send RM updates to Scheduler</strong></p><p>For most cases, Cache propagate updates from RM to scheduler directly (including Application, Node, Asks, etc.). And it is possible that some updates from RM is not valid (such as adding an application to a non-existed queue), for such cases, cache can send an event back to RMProxy and notify the ResourceManager. (See <code>RMApplicationUpdateEvent.RejectedApplications</code>)</p><p><strong>Cache handles scheduler config</strong> </p><p>Cache also handles scheduler&#x27;s config changes, see</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-go codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">func</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">m </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">ClusterInfo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">processRMConfigUpdateEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">event </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">commonevents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">ConfigUpdateRMEvent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></div></div></div></div></div><p>Similar to other RM updates, it propages news to scheduelr.</p><p><strong>Scheduler do allocation</strong></p><p>Once an AllocationProposal created by scheduler, scheduler sends <code>AllocationProposalBundleEvent</code> to Cache to commit. </p><p>Cache look at AllocationProposal under lock, and commit these proposals. The reason to do proposal/commit is Scheduler can run in multi-threads which could cause conflict for resource allocation. This approach is inspired by Borg/Omega/YARN Global Scheduling.</p><p>Cache checks more states such as queue resources, node resources (we cannot allocate more resource than nodes&#x27; available), etc. Once check is done, Cache updates internal data strcture and send confirmation to Scheduler to update the same, and scheduler sends allocated Allocation to RMProxy so Shim can do further options. For example, K8shim will <code>bind</code> an allocation (POD) to kubelet.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Job Add:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Cache -&gt; Scheduler (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Job Remove:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-----------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Scheduler -&gt; Cache (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Released allocations: (Same as normal release) (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Note: Make sure remove from scheduler first to avoid new allocated created. </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Scheduling Request Add:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-----------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Cache -&gt; Scheduler (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Note: Will check if requested job exists, queue exists, etc.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">When any request invalid:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Cache -&gt; RM (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Scheduler -&gt; RM (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Scheduling Request remove:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">------------------------- </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Scheduler -&gt; Cache (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Note: Make sure removed from scheduler first to avoid new container allocated</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Allocation remove (Preemption) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-----------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Scheduler -&gt; Cache -&gt; RM (TODO)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              (confirmation)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Allocation remove (RM voluntarilly ask)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">---------------------------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Scheduler -&gt; Cache -&gt; RM. (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      (confirmation)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Node Add: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">---------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Cache -&gt; Scheduler (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Note: Inside Cache, update allocated resources.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Error handling: Reject Node to RM (Implemented)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Node Remove: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Implemented in cache side</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM -&gt; Scheduler -&gt; Cache (TODO)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Allocation Proposal:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Scheduler -&gt; Cache -&gt; RM</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">When rejected/accepted:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Cache -&gt; Scheduler</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Initial: (TODO)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1. Admin configured partitions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2. Cache initializes</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">3. Scheduler copies configurations</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Relations between Entities </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-------------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1. RM includes one or multiple:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Partitions </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Jobs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Nodes </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Queues</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2. One queue: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Under one partition</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Under one RM.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">3. One job: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Under one queue (Job with same name can under different partitions)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   - Under one partition</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM registration: (TODO)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">----------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">1. RM send registration</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2. If RM already registered, remove old one, including everything belong to RM.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">RM termination (TODO) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">--------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Just remove the old one.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Update of queues (TODO) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">------------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Admin Service -&gt; Cache</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">About partition (TODO) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-----------------------</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Internal partition need to be normalized, for example, RM specify node with partition = xyz. </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Scheduler internally need to normalize it to &lt;rm-id&gt;_xyz</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">This need to be done by RMProxy</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div></div></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/0.9.0/design/architecture"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Architecture</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/0.9.0/design/k8shim"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Kubernetes Shim Design Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#components" class="table-of-contents__link">Components:</a><ul><li><a href="#scheduler-cache" class="table-of-contents__link">Scheduler Cache</a></li><li><a href="#scheduler-cache-event-handler" class="table-of-contents__link">Scheduler Cache Event Handler</a></li><li><a href="#admin-service" class="table-of-contents__link">Admin Service</a></li><li><a href="#scheduler-and-preemptor" class="table-of-contents__link">Scheduler and Preemptor</a></li></ul></li><li><a href="#schedulers-responsibility" class="table-of-contents__link">Scheduler&#39;s responsibility</a></li><li><a href="#preemption" class="table-of-contents__link">Preemption</a></li><li><a href="#communication-between-shim-and-core" class="table-of-contents__link">Communication between Shim and Core</a></li><li><a href="#configurations--semantics" class="table-of-contents__link">Configurations &amp; Semantics</a></li><li><a href="#how-scheduler-do-allocation" class="table-of-contents__link">How scheduler do allocation</a></li><li><a href="#flow-of-events" class="table-of-contents__link">Flow of events</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Blog</h4><ul class="footer__items"><li class="footer__item"><a href="https://blog.cloudera.com/yunikorn-a-universal-resources-scheduler/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s YuniKorn?</a></li><li class="footer__item"><a href="https://blog.cloudera.com/apache-yunikorn-incubating-0-8-release-whats-new-and-upcoming/" target="_blank" rel="noopener noreferrer" class="footer__link-item">What&#x27;s new in YuniKorn 0.8.0?</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Github</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-core</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-k8shim" target="_blank" rel="noopener noreferrer" class="footer__link-item">kubernetes-shim</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-scheduler-interface" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-interface</a></li><li class="footer__item"><a href="https://github.com/apache/incubator-yunikorn-web" target="_blank" rel="noopener noreferrer" class="footer__link-item">scheduler-web</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/community/get_involved">Get Involved</a></li><li class="footer__item"><a href="http://people.apache.org/phonebook.html?podling=yunikorn" target="_blank" rel="noopener noreferrer" class="footer__link-item">Roster</a></li><li class="footer__item"><a href="https://issues.apache.org/jira/projects/YUNIKORN/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issues</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1zJy"><img class="footer__logo" alt="Apache Incubator Logo" src="https://incubator.apache.org/images/incubator_feather_egg_logo.png"></a></div><div>
Copyright Â© 2021 <a href="http://www.apache.org/">The Apache Software Foundation</a>. Licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>. <br>
<div style="padding:20px; margin: 10px; color: #4d4d4d;">
  Apache YuniKorn is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the name of Apache TLP sponsor.
  Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications,
  and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily
  a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF.
</div>
</div></div></div></footer></div>
<script src="/styles.42927ee7.js"></script>
<script src="/runtime~main.1daa9f04.js"></script>
<script src="/main.6222ead5.js"></script>
<script src="/1.f2f38753.js"></script>
<script src="/2.05510059.js"></script>
<script src="/3.a37a1908.js"></script>
<script src="/1be78505.e1f44db4.js"></script>
<script src="/146.37105179.js"></script>
<script src="/9a6d52da.085a8bc2.js"></script>
<script src="/17896441.6af894f7.js"></script>
<script src="/b8c87182.22e9f1cb.js"></script>
</body>
</html>